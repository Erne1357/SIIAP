<table class="table table-hover align-middle" id="archiveTable">
  <thead class="table-light">
    <tr>
      <th style="width:32px;"></th>
      <th>Documento</th>
      <th style="width:160px;">Plantilla</th>
      <th style="width:120px;">Estado</th>
      <th style="width:140px;">Acciones</th>
      <th>Observaciones</th>
      <th style="width:130px;">Revisado</th>
    </tr>
  </thead>

  <tbody>
  {% for arch in step.archives %}
    {% set sub = subs.get(arch.id) %}
    {% set row_id = "row-" ~ arch.id %}

    <!-- Fila principal --------------------------------------------------- -->
    <tr>
      <td><i class="far fa-file-alt text-secondary"></i></td>
      <td>
        <a class="text-decoration-none" data-bs-toggle="collapse"
           href="#{{ row_id }}" role="button">
          {{ arch.name }}
          <i class="fas fa-chevron-down small ms-1"></i>
        </a>
      </td>

      <!-- Plantilla -->
      <td>
        {% if arch.is_downloadable and arch.file_path %}
          <a class="btn btn-link btn-sm"
             href="{{ url_for('files.template', filename=arch.file_path) }}"
             target="_blank">Descargar</a>
        {% else %} — {% endif %}
      </td>

      <!-- Estado -->
      <td>
        {% if not sub %}
          <span class="badge bg-secondary">Pendiente</span>
        {% elif sub.status == 'approved' %}
          <span class="badge bg-success">Aprobado</span>
        {% elif sub.status == 'rejected' %}
          <span class="badge bg-danger">Rechazado</span>
        {% else %}
          <span class="badge bg-warning text-dark">En revisión</span>
        {% endif %}
      </td>

      <!-- Acciones -->
      <td class="d-flex gap-1">
        {% if arch.is_uploadable %}
          {% if sub %}
            <a class="btn btn-outline-primary btn-sm" title="Ver"
              href="{{ url_for('files.user_doc',
                                user_id=current_user.id,
                                phase='admission',
                                filename=sub.file_path.split('/')[-1]) }}">
              <i class="fas fa-eye"></i>
            </a>
          {% endif %}

          <button class="btn btn-outline-success btn-sm"
                  title="Subir / Reemplazar"
                  data-bs-toggle="modal"
                  data-bs-target="#uploadModal"
                  data-archive="{{ arch.id }}">
            <i class="fas fa-upload"></i>
          </button>

          {% if sub %}
            <form method="POST"
                  action="{{ url_for('program.admission.delete_submission', sub_id=sub.id) }}"
                  onsubmit="return confirm('¿Eliminar archivo?');">
              <button class="btn btn-outline-danger btn-sm" title="Borrar">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          {% endif %}
        {% else %}
            <i class="fas fa-ban"></i><span style="font : italic">Sin acciones disponibles</span>
        {% endif %}
      </td>

      <!-- Observaciones -->
      <td>
        {% if sub and sub.reviewer_comment %}
          {{ sub.reviewer_comment }}
        {% else %}
          — 
        {% endif %}
      </td>

      <!-- Fecha de revisión -->
      <td>
        {% if sub and sub.review_date %}
          {{ sub.review_date.strftime('%d/%m/%Y') }}
        {% else %}
          —
        {% endif %}
      </td>
    </tr>

    <!-- Fila descripción colapsable -------------------------------------- -->
    <tr id="{{ row_id }}" class="collapse">
      <td></td>
      <td colspan="6" class="text-muted small">  {# icon + 6 columnas #}
        {{ arch.description }}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
